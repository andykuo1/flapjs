!function(t){var e={};function s(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);var n=class{constructor(){this.eventMap=new Map}addListener(t,e){this.eventMap.has(t)||this.eventMap.set(t,[]),this.eventMap.get(t).push(e)}removeListener(t,e){if(!this.eventMap.has(t))return;const s=this.eventMap.get(t);s.splice(s.indexOf(e),1)}clearListeners(t){this.eventMap.has(t)&&(this.eventMap.get(t).length=0)}countListeners(t){return this.eventMap.has(t)?this.eventMap.get(t).length:0}getListeners(t){return this.eventMap.get(t)}emit(t){if(!this.eventMap.has(t))return;const e=Array.prototype.splice.call(arguments,1),s=this.eventMap.get(t),n=s.length;let i=0;for(;i<n;)s[i].apply(null,e)?(s.splice(i,1),--i):++i;this.onEventProcessed(t,e)}on(t,e){this.addListener(t,e)}once(t,e){this.addListener(t,()=>(e(),!0))}onEventProcessed(t,e){}};var i=class{constructor(t,e){this.x=0,this.y=0,this.scrollX=0,this.scrollY=0,this.events=new n,this._canvas=t,this._element=e,this._mouseup=this.onMouseUp.bind(this),this._mousedown=this.onMouseDown.bind(this),this._mouseclick=this.onMouseClick.bind(this),this._mousemove=this.onMouseMove.bind(this),this._wheel=this.onMouseWheel.bind(this),this._touchstart=this.onTouchStart.bind(this),this._touchmove=this.onTouchMove.bind(this),this._touchstop=this.onTouchStop.bind(this),this._contextmenu=(t=>(t.preventDefault(),!1)),this._element.addEventListener("contextmenu",this._contextmenu,!1),this._element.addEventListener("mouseup",this._mouseup),this._element.addEventListener("mousedown",this._mousedown),this._element.addEventListener("click",this._mouseclick),this._element.addEventListener("mousemove",this._mousemove),this._element.addEventListener("wheel",this._wheel),this._element.addEventListener("touchstart",this._touchstart)}destroy(){this._element.removeEventListener("contextmenu",this._contextmenu),this._element.removeEventListener("mouseup",this._mouseup),this._element.removeEventListener("mousedown",this._mousedown),this._element.removeEventListener("click",this._mouseclick),this._element.removeEventListener("mousemove",this._mousemove),this._element.removeEventListener("wheel",this._wheel),this._element.removeEventListener("touchstart",this._touchstart)}onMouseUp(t){this.onMouseMove(t),this.events.emit("mouseup",this,t.which)}onMouseDown(t){this.onMouseMove(t),this.events.emit("mousedown",this,t.which)}onMouseClick(t){this.onMouseMove(t),this.events.emit("mouseclick",this,t.which)}onMouseWheel(t){this.scrollX+=t.deltaX,this.scrollY+=t.deltaY,this.events.emit("wheel",this,t.deltaX,t.deltaY)}onMouseMove(t){const e=this._canvas.getBoundingClientRect();this.x=t.clientX-e.left,this.y=t.clientY-e.top}onTouchStart(t){const e=t.touches[0].target;e.addEventListener("touchmove",this._touchmove),e.addEventListener("touchend",this._touchstop),e.addEventListener("touchcancel",this._touchstop)}onTouchStop(t){const e=t.touches[0].target;e.removeEventListener("touchmove",this._touchmove),e.removeEventListener("touchend",this._touchstop),e.removeEventListener("touchcancel",this._touchstop)}onTouchMove(t){this.onMouseMove(t.touches[0])}};const o=Math.PI/2,h=2*Math.PI,a=16,r=12,c=a*a,l=document.getElementById("content"),u=l.getContext("2d"),d=new i(l,document),v=new class{constructor(){this.targetSource=null,this.targetDestination=null,this.moveTarget=null,this.states=[],this.transitions=[],this.nextAvailableStateID=0}createNewState(){const t=Math.random()*l.width,e=Math.random()*l.height,s={x:t,y:e,nextX:t,nextY:e,id:this.nextAvailableStateID++,accept:!1};return this.states.push(s),s}createNewTransition(t,e){const s={source:t,destination:e};return this.transitions.push(s),s}makeInitialState(t){this.states.splice(this.states.indexOf(t),1),this.states.unshift(t)}toggleAcceptState(t){t.accept=!t.accept}markTarget(t,e){this.targetSource=this.getStateByPosition(t,e),this.isSelfMode=!0}releaseTarget(t,e){if(null===this.targetSource)return;const s=this.getStateByPosition(t,e);this.isSelfMode||null===this.targetDestination?s===this.targetSource&&this.toggleAcceptState(s):this.createNewTransition(this.targetSource,this.targetDestination),this.targetSource=null,this.targetDestination=null}startMove(t,e){this.moveTarget=this.getStateByPosition(t,e)}endMove(t,e){null!==this.moveTarget&&(this.moveTarget.nextX=t,this.moveTarget.nextY=e),this.moveTarget=null}getStateByPosition(t,e){for(const s of this.states){const n=t-s.x,i=e-s.y;if(n*n+i*i<c)return s}return null}getNearestState(t){let e=null,s=0;for(const n of this.states){if(t===n)continue;const i=t.x-n.x,o=t.y-n.y,h=i*i+o*o;(null===e||h<s)&&(e=n,s=h)}return{state:e,length:s}}onUpdate(t){if(null!==this.targetSource){const t=this.getStateByPosition(d.x,d.y);this.isSelfMode&&t!==this.targetSource&&(this.isSelfMode=!1),this.isSelfMode||(this.targetDestination=t)}for(const t of this.states)t.x+=.06*(t.nextX-t.x),t.y+=.06*(t.nextY-t.y),Math.abs(t.x-t.nextX)<.001&&(t.nextX=t.x),Math.abs(t.y-t.nextY)<.001&&(t.nextY=t.y)}onRender(t,e){const s=t.fillStyle="yellow",n=(t.strokeStyle="black",t.font="12px Arial",t.textAlign="center",[6,4]);if(this.states.length>0){const e=this.states[0],s=e.x,n=e.y;t.beginPath(),t.moveTo(s-a,n),t.lineTo(s-2*a,n-a),t.lineTo(s-2*a,n+a),t.closePath(),t.fill(),t.stroke()}for(const e of this.states){const n=e.x,i=e.y;t.beginPath(),t.arc(n,i,a,0,h),t.fill(),t.stroke(),e.accept&&(t.beginPath(),t.arc(n,i,r,0,h),t.stroke()),t.fillStyle="black",t.fillText("q"+e.id,n,i+4),t.fillStyle=s}for(const e of this.transitions)g(t,e.source,e.destination);if(null===this.targetSource||this.isSelfMode||g(t,this.targetSource,null===this.targetDestination?d:this.targetDestination),null!==this.moveTarget){const s=e/1e3%h;t.save(),t.beginPath(),t.setLineDash(n),t.arc(d.x,d.y,a,0+s,h+s),t.stroke(),t.restore()}}};function m(t){l.width=window.innerWidth,l.height=window.innerHeight}d.events.on("mousedown",function(t,e){3===e?v.startMove(t.x,t.y):v.markTarget(t.x,t.y)}),d.events.on("mouseup",function(t,e){3===e?v.endMove(t.x,t.y):v.releaseTarget(t.x,t.y)}),document.getElementById("newstate").addEventListener("click",function(t){v.createNewState()}),window.addEventListener("load",m),window.addEventListener("resize",m),window.requestAnimationFrame(function t(e){u.clearRect(0,0,l.width,l.height);v.onUpdate(e);v.onRender(u,e);window.requestAnimationFrame(t)});function g(t,e,s){const n=e.x-s.x,h=e.y-s.y,c=-Math.atan2(h,n)-o,l=a*Math.sin(c),u=a*Math.cos(c);s instanceof i?M(t,e.x+l,e.y+u,s.x,s.y):e===s?(t.beginPath(),t.arc(e.x+4*r/3,e.y-4*r/3,r,Math.PI,Math.PI/2),t.stroke()):M(t,e.x+l,e.y+u,s.x-l,s.y-u)}function M(t,e,s,n,i){const o=Math.atan2(i-s,n-e);t.beginPath(),t.moveTo(e,s),t.lineTo(n,i),function(t,e,s,n,i){t.moveTo(e,s),t.lineTo(e-n*Math.cos(i-Math.PI/6),s-n*Math.sin(i-Math.PI/6)),t.moveTo(e,s),t.lineTo(e-n*Math.cos(i+Math.PI/6),s-n*Math.sin(i+Math.PI/6))}(t,n,i,8,o),t.stroke()}}]);